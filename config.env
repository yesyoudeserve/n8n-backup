#!/bin/bash
# ============================================
# Configuração de Backup N8N
# Arquivo: /opt/n8n-backup/config.env
# ============================================

# === CONFIGURAÇÕES DO N8N ===
N8N_POSTGRES_HOST="n8n_postgres"
N8N_POSTGRES_PORT="5432"
N8N_POSTGRES_DB="n8n"
N8N_POSTGRES_USER="postgres"
N8N_POSTGRES_PASSWORD="SUA_SENHA_POSTGRES"  # ALTERAR!

# CRÍTICO: Encryption Key do N8N (encontrar no EasyPanel)
N8N_ENCRYPTION_KEY="SUA_CHAVE_ENCRYPTION"  # ALTERAR!

# === CONFIGURAÇÕES DE BACKUP ===
BACKUP_ROOT="/opt/n8n-backup"
BACKUP_LOCAL_DIR="${BACKUP_ROOT}/backups/local"
LOG_FILE="${BACKUP_ROOT}/logs/backup.log"

# Retenção de backups locais (dias)
LOCAL_RETENTION_DAYS=2

# Retenção de backups remotos
REMOTE_RETENTION_DAILY=7      # Últimos 7 dias completos
REMOTE_RETENTION_WEEKLY=30    # 4 semanas
REMOTE_RETENTION_MONTHLY=90   # 3 meses

# === ORACLE OBJECT STORAGE ===
ORACLE_ENABLED=true
ORACLE_NAMESPACE="seu-namespace"           # ALTERAR!
ORACLE_BUCKET="n8n-backups"
ORACLE_REGION="eu-madrid-1"               # Região: Madrid, Espanha
ORACLE_COMPARTMENT_ID="ocid1.compartment.oc1..xxx"  # ALTERAR!

# === BACKBLAZE B2 (OFFSITE) ===
B2_ENABLED=true
B2_ACCOUNT_ID="sua-account-id"            # ALTERAR!
B2_APPLICATION_KEY="sua-app-key"          # ALTERAR!
B2_BUCKET="n8n-backups-offsite"

# === NOTIFICAÇÕES (OPCIONAL) ===
NOTIFY_EMAIL=""                           # Email para alertas
NOTIFY_WEBHOOK=""                         # Webhook Discord/Slack

# === CONFIGURAÇÕES AVANÇADAS ===
COMPRESSION_LEVEL=6                       # 1-9 (6 é bom equilíbrio)
PARALLEL_COMPRESSION=true                 # Usar pigz (mais rápido)
BACKUP_EXECUTIONS_DAYS=7                  # Dias de executions para backup

# === EASYPANEL CONFIGS ===
EASYPANEL_CONFIG_DIR="/etc/easypanel"     # Ajustar se necessário
BACKUP_EASYPANEL_CONFIGS=true

# === SEGURANÇA (NOVO) ===
BACKUP_MASTER_PASSWORD="ALTERAR_SENHA_MESTRA_AQUI"  # Senha para criptografar chaves (mínimo 12 caracteres)
ENCRYPT_SENSITIVE_DATA=true               # Criptografar dados sensíveis nos backups
VERIFY_BACKUP_INTEGRITY=true             # Verificar integridade com hashes

# === MONITORAMENTO (NOVO) ===
ENABLE_HEALTH_CHECKS=true                # Habilitar health checks automáticos
HEALTH_CHECK_INTERVAL=60                 # Intervalo em minutos para health checks
